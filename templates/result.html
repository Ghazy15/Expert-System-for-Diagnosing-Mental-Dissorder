<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Diagnosa</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        h1, h2 { color: #333; }
        .conclusion { background-color: #e6f7ff; border: 1px solid #b3e0ff; padding: 15px; border-radius: 4px; }
        .conclusion p { font-size: 1.2em; margin: 0; }
        .details ul { list-style-type: none; padding-left: 0; }
        .details li { background-color: #f9f9f9; padding: 8px; border: 1px solid #eee; margin-bottom: 5px; }
        .details li strong { min-width: 60px; display: inline-block; }
        a { color: #007bff; text-decoration: none; display: inline-block; margin-top: 20px; }
        a:hover { text-decoration: underline; }

        /* === CSS BARU UNTUK LOG === */
        .log-details ul {
            background-color: #2b2b2b;
            color: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        .log-details li {
            background-color: transparent;
            border: none;
            padding: 2px 0;
            margin: 0;
            color: #f1f1f1;
            border-bottom: 1px dotted #555;
        }
        .log-details li:last-child {
            border-bottom: none;
        }
        .log-success { color: #a5d6a7; } /* Hijau muda */
        .log-fail { color: #ef9a9a; } /* Merah muda */
        .log-calc { color: #80cbc4; } /* Teal */
        .log-rule { color: #ffd54f; font-weight: bold;} /* Kuning */
        /* === AKHIR CSS BARU === */

    </style>
</head>
<body>
    <div class="container">
        <h1>Hasil Konsultasi</h1>

        {% if top_diagnosis %}
            <div class="conclusion">
                <h2>Kesimpulan</h2>
                <p>
                    Berdasarkan gejala yang ada, kesimpulan utamanya adalah Anda memiliki kemungkinan 
                    <strong>{{ top_diagnosis.name }}</strong> 
                    dengan tingkat kepastian <strong>{{ top_diagnosis.cf_percent }}%</strong>.
                </p>
            </div>
        {% else %}
            <div class="conclusion">
                <p>Tidak ada diagnosa yang dapat disimpulkan berdasarkan gejala yang Anda berikan.</p>
            </div>
        {% endif %}

        <div class="details">
            <h2>Gejala yang Anda Masukkan:</h2>
            <ul>
                {% for name, val in inputs.items() %}
                    <li>{{ name }} (Nilai CF: {{ val }})</li>
                {% endfor %}
            </ul>
        </div>
        
        {% if all_new_facts %}
            <div class="details">
                <h2>Semua Fakta Baru yang Ditemukan (Proses Inferensi)</h2>
                <p>Daftar ini menampilkan semua hipotesis (gejala turunan dan diagnosa) yang berhasil dihitung oleh sistem, mirip dengan "Tabel 6" pada jurnal.</p>
                <ul>
                    {% for fact in all_new_facts %}
                        <li>
                            <strong>{{ fact.code }}:</strong> {{ fact.name }} 
                            (Nilai CF: {{ "%.3f"|format(fact.cf_value) }})
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if results %}
            <div class="details">
                <h2>Detail Diagnosa Akhir (MXXX):</h2>
                <ul>
                    {% for res in results %}
                        <li><strong>{{ res.code }}:</strong> {{ res.name }} (Nilai CF: {{ res.cf_percent }}%)</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if inference_log %}
            <div class="details log-details">
                <h2>Log Proses Inferensi (Pelacakan)</h2>
                <p>Ini adalah jejak langkah-demi-langkah yang diambil oleh mesin inferensi untuk mendapatkan kesimpulan.</p>
                <ul>
                    {% for step in inference_log %}
                        <li>
                            {% if "SUKSES" in step %}
                                <span class="log-success">{{ step }}</span>
                            {% elif "GAGAL" in step %}
                                <span class="log-fail">{{ step }}</span>
                            {% elif "Mencari" in step or "Menghitung" in step or "Menggabungkan" in step or "Menetapkan" in step %}
                                <span class="log-calc">{{ step }}</span>
                            {% elif "---" in step or "FAKTA:" in step %}
                                <span class="log-rule">{{ step }}</span>
                            {% else %}
                                {{ step }}
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        <a href="/">Kembali ke Halaman Utama</a>
    </div>
</body>

</html>
